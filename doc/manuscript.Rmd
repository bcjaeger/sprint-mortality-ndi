---
title: "Longer term All-Cause and Cardiovascular Mortality with Intensive Blood Pressure Control"
bibliography: refs.bib
csl: lancet.csl
always_allow_html: true
output: 
  officedown::rdocx_document:
    reference_docx: style_manuscript_times_new_roman.docx
---

Byron C. Jaeger, PhD^1^ 
Paul E. Drawz, DEGREES^2^ 
Paul K. Whelton, DEGREES^3^ 
Mark A. Supiano, DEGREES^4^ 
Adam P. Bress, PharmD, MS^5,6^
Jeff D. Williamson, DEGREES^7^
David M. Reboussin, DEGREES^1^, and
Nicholas M. Pajewski, PhD^1^ 

<!-- Jackson T. Wright Jr., MD, PhD, Alfred K. Cheung, MD, William C. Cushman, MD, Cora E. Lewis, MD, Suzanne Oparil, MD, Michael V. Rocco, MD and Karen Johnson, MD -->

^1^Department of Biostatistics and Data Science, Wake Forest School of Medicine, Winston-Salem, NC

^2^Division of Renal Diseases & Hypertension, University of Minnesota, Minneapolis. 

^3^Department of Epidemiology, Tulane University School of Public Health and Tropical Medicine, New Orleans, LA. 

^4^Division of Geriatrics, University of Utah School of Medicine, Salt Lake City.  

^5^	Informatics, Decision-Enhancement, and Analytic Sciences (IDEAS) Center, Veterans Affairs, Salt Lake City Health Care System, Salt Lake City, UT

^6^	Department of Population Health Sciences, University of Utah School of Medicine, Salt Lake City, UT

^7^Section on Gerontology and Geriatric Medicine, Wake Forest School of Medicine, Winston-Salem, NC. 


```{r setup, include=FALSE}


knitr::opts_chunk$set(echo = FALSE, 
                      message = FALSE,
                      warning = FALSE,
                      dpi = 600, 
                      fig.width = 11, 
                      fig.height = 6.25)

# specification for table tables
rspec <- round_spec() |>
  round_using_magnitude(digits = c(2, 1, 0),
                        breaks = c(10, 100, Inf))

# save it to options:
names(rspec) <- paste('table.glue', names(rspec), sep = '.')
options(rspec)

```

```{r load-targets, include=FALSE}

tar_load(names = c(recoders,
                   base_viz_inc,
                   base_viz_eff,
                   long_viz_mort,
                   long_viz_cvd,
                   base_ds, 
                   long_ds,
                   long_inf,
                   base_inf,
                   ndi_baseline))

fig <- left_join(base_viz_inc, base_viz_eff)

inline <- list()

tbl_variables <- c('variable', 'group', 'treatment')

inline$base_ds <- base_ds |>
  mutate(across(matches("est$|lwr$|upr"), table_value),
         across(matches("^n_"), ~table_value(as.integer(.x)))) |>
  as_inline(tbl_variables = tbl_variables,
            tbl_values = setdiff(names(base_ds), tbl_variables))

tbl_variables <- c('variable', 'group', 'trial_phase')

inline$long_inf <- long_inf |>
  mutate(across(matches("est$|lwr$|upr"), table_value),
         across(matches("^n_"), ~table_value(as.integer(.x)))) |>
  as_inline(tbl_variables = tbl_variables,
            tbl_values = setdiff(names(long_inf), tbl_variables))


```

\newpage

# ABSTRACT

__Background__. Both the Systolic Blood Pressure Intervention Trial (SPRINT) and the Strategy of Blood Pressure Intervention in the Elderly Hypertensive Patients (STEP) trial have shown benefits of intensive blood pressure control on cardiovascular morbidity and mortality. However, as both trials were ended after slightly more than 3 years of follow-up, the legacy effect of intensive treatment on longer term cardiovascular and all-cause mortality is unknown. 

__Methods__. We linked participants in SPRINT to the National Death Index (NDI, 2016 to 2020), assessing cardiovascular mortality using the NDI plus system. Cox and competing risk regression models were used to model the effect of intensive treatment through the trial and during post-trial follow-up on all-cause and cardiovascular mortality respectively      

```{r}

# ap makes inline insertion of results less text-heavy.
# ap = access point, 
# b = baseline, l = longitudinal
# o = overall, i = intensive, s = standard,
# t = trial, c = cohort

ap_b_o <- inline$base_ds$overall$overall$overall
ap_b_i <- inline$base_ds$overall$overall$Intensive
ap_b_s <- inline$base_ds$overall$overall$Standard

ap_l_o_t <- inline$long_inf$overall$overall$trial
ap_l_o_c <- inline$long_inf$overall$overall$cohort

# make the . symbol equivalent to calling table_glue.
# Another way to makes inline insertion of results less text-heavy
. <- table.glue::table_glue

```


__Results__. Over a median follow-up of `r ap_b_o$fup_est` years, there were `r ap_b_i$n_cvd` and `r ap_b_i$n_acm` cardiovascular and all-cause deaths with intensive treatment respectively, and `r ap_b_s$n_cvd` cardiovascular / `r ap_b_s$n_acm` all-cause deaths for standard treatment. Intensive treatment was beneficial for both cardiovascular (Hazard Ratio [HR] = `r with(ap_l_o_t, .("{cvd_est}, 95% CI {cvd_lwr} to {cvd_upr}"))`) and all-cause mortality (HR = `r with(ap_l_o_t, .("{mort_est}, 95% CI {mort_lwr} to {mort_upr}"))`) through close-out visits for the trial (follow-up through July 2016). However, there was no indication of benefit during post-trial follow-up for either cardiovascular (HR = `r with(ap_l_o_c, .("{cvd_est}, 95% CI {cvd_lwr} to {cvd_upr}"))`) or all-cause mortality (HR = `r with(ap_l_o_c, .("{mort_est}, 95% CI {mort_lwr} to {mort_upr}"))`). Results were similar for subgroups based on baseline age, cognitive function, and frailty status. 

__Conclusions__. Our results show a clear benefit for cardiovascular and all-cause mortality during the trial which was largely attenuated during post-trial observational follow-up. Given indications of increasing blood pressures in SPRINT participants randomized to intensive treatment following the trial, these results highlight the importance of consistent long-term management of hypertension in line with current guidelines. 
\newpage

<!-- END OF ABSTRACT -->

# INTRODUCTION

# METHODS

___Statistical Analysis___: The effect of randomization to intensive treatment was estimated as a function of time using two approaches. The first approach split the follow-up of study participants into non-overlapping trial and cohort phases, then estimated the effect of randomization to intensive treatment in each phase [@zhang_time_varying_2018]. The second approach estimated the cumulative time-dependent effect of randomization to intensive treatment [@martinussen2007dynamic]. While the phase-specific estimate of the treatment effect treats the trial and cohort phases independently, the cumulative estimate enforces continuity of the treatment effect through time so that the effect of treatment during the trial phase is not 'forgotten' during the cohort phase. All analyses accounted for correlation within study sites [@lin_robust_1989], and analyses of cardiovascular mortality accounted for the competing risk of non-cardiovascular mortality [@scheike_flexible_2008].

# RESULTS

In both treatment groups, median follow-up time was `r ap_b_o$fup_est` years. A total of `r ap_b_i$n_acm` and `r ap_b_s$n_acm` all-cause mortality events occurred among participants randomized to intensive and standard treatment, respectively (__Table 1__). The hazard ratio (HR) for all-cause mortality among participants randomized to intensive versus standard treatment was `r with(ap_l_o_t, .("{mort_est} (95% confidence interval [CI] {mort_lwr}, {mort_upr})"))` during the trial phase and `r with(ap_l_o_c, .("{mort_est} (95% CI {mort_lwr}, {mort_upr})"))` during the cohort phase. The cumulative time-varying effect of intensive versus standard treatment indicated lower risk for all-cause mortality during the trial phase and was attenuated during the cohort phase (__Figure 1__). 


# DISCUSSION



```{r}

block_section(
  prop_section(
    page_size = page_size(orient = "portrait"),
    type = "continuous"
  )
)

```

__Table 1__: All-cause mortality by treatment group and subgroup 

```{r}

tbl_inf <- long_inf |> 
  mutate(mort = .("{mort_est}\n({mort_lwr}, {mort_upr})")) |> 
  select(variable,
         group, 
         trial_phase,
         mort) |> 
  pivot_wider(names_from = trial_phase,
              values_from = mort,
              names_prefix = '.h_')

tbl_data <- long_ds |>
  mutate(
    across(starts_with("n_"), as.integer),
    .n = .("{n_acm} / {n_obs}"),
    .i = .("{inc_mort_est}\n({inc_mort_lwr}, {inc_mort_upr})")
  ) |>
  select(-starts_with("inc_"),
         -starts_with("n_")) |> 
  pivot_wider(names_from = c(treatment, trial_phase),
              values_from = c(.n, .i)) |> 
  left_join(tbl_inf) |> 
  mutate(
    variable = replace(variable, group == variable, NA_character_),
    variable = recode(variable, !!!recoders$variable),
    group = recode(group, !!!recoders$group)
  )
  

tbl_object <- tbl_data |> 
  select(variable,
         group,
         .n_Standard_trial,
         .n_Intensive_trial,
         .i_Standard_trial,
         .i_Intensive_trial,
         .h_trial,
         .n_Standard_cohort,
         .n_Intensive_cohort,
         .i_Standard_cohort,
         .i_Intensive_cohort,
         .h_cohort) |> 
  as_grouped_data(groups = 'variable') |> 
  drop_na_rows() |> 
  as_flextable(hide_grouplabel = TRUE) |> 
  add_header_row(
    values = c(" ", 
               "N Events / N Total", 
               "Incidence\n(95% CI)", 
               "Hazard Ratio\n(95% CI)",
               "N Events / N Total", 
               "Incidence\n(95% CI)",
               "Hazard Ratio\n(95% CI)"),
    colwidths = c(1, 2, 2, 1, 2, 2, 1)
  ) |> 
  add_header_row(
    values = c(" ", 
               "Trial Follow-up Through Close-out Visits",
               "Post-trial Follow-up"),
    colwidths = c(1, 5, 5)
  ) |> 
  set_header_labels(
    group = " ",
    .n_Standard_trial   = "Standard",
    .n_Intensive_trial  = "Intensive",
    .i_Standard_trial   = "Standard",
    .i_Intensive_trial  = "Intensive",
    .h_trial            = "Hazard Ratio\n(95% CI)",
    .n_Standard_cohort  = "Standard",
    .n_Intensive_cohort = "Intensive",
    .i_Standard_cohort  = "Standard",
    .i_Intensive_cohort = "Intensive",
    .h_cohort           = "Hazard Ratio\n(95% CI)"
  ) |> 
  merge_v(part = 'header') |>
  theme_box() |> 
  padding(j = 1, i = ~ !is.na(group), padding.left = 15, part = 'body') |> 
  bg(i = ~ is.na(group), bg = 'grey80') |> 
  italic(i = ~ is.na(group), italic = TRUE) |> 
  width(width = 0.95) |> 
  width(j=1, width = 1.5) |> 
  align(align = 'center', part = 'all') |> 
  align(j = 1, align = 'left', part = 'all') |> 
  fontsize(size = 12, part = 'all') |> 
  font(fontname = 'Times New Roman', part = 'all')

tbl_object


```

\newpage
__Table 2__: Cardiovascular and non-cardiovascular mortality by treatment group and subgroup 

```{r}

tbl_inf <- long_inf |> 
  mutate(cvd = .("{cvd_est}\n({cvd_lwr}, {cvd_upr})"),
         non = .("{other_est}\n({other_lwr}, {other_upr})")) |> 
  select(variable,
         group, 
         trial_phase,
         cvd,
         non) |> 
  pivot_wider(names_from = trial_phase,
              values_from = c(cvd, non),
              names_glue = ".h_{.value}_{trial_phase}")

tbl_data <- long_ds |>
  mutate(
    across(starts_with("n_"), as.integer),
    .n = .("{n_cvd} / {n_other} / {n_obs}")
  ) |>
  select(-starts_with("inc_"),
         -starts_with("n_")) |> 
  pivot_wider(names_from = c(treatment, trial_phase),
              values_from = c(.n),
              names_prefix = '.n_') |> 
  left_join(tbl_inf) |> 
  mutate(
    variable = replace(variable, group == variable, NA_character_),
    variable = recode(variable, !!!recoders$variable),
    group = recode(group, !!!recoders$group)
  )
  

tbl_object <- tbl_data |> 
  select(variable,
         group,
         .n_Standard_trial,
         .n_Intensive_trial,
         .h_cvd_trial,
         .h_non_trial,
         .n_Standard_cohort,
         .n_Intensive_cohort,
         .h_cvd_cohort,
         .h_non_cohort) |> 
  as_grouped_data(groups = 'variable') |> 
  drop_na_rows() |> 
  as_flextable(hide_grouplabel = TRUE) |> 
  add_header_row(
    values = c(" ", 
               "N\nCVD / non-CVD / Total", 
               "Hazard Ratio\n(95% CI)",
               "N\nCVD / non-CVD / Total", 
               "Hazard Ratio\n(95% CI)"),
    colwidths = c(1, 2, 2, 2, 2)
  ) |> 
  add_header_row(
    values = c(" ", 
               "Trial Follow-up Through Close-out Visits",
               "Post-trial Follow-up"),
    colwidths = c(1, 4, 4)
  ) |> 
  set_header_labels(
    group = " ",
    .n_Standard_trial= "Standard",
    .n_Intensive_trial= "Intensive",
    .h_cvd_trial = "CVD",
    .h_non_trial = "Non-CVD",
    .n_Standard_cohort = "Standard",
    .n_Intensive_cohort = "Intensive",
    .h_cvd_cohort = "CVD",
    .h_non_cohort = "Non-CVD"
  ) |> 
  merge_v(part = 'header') |>
  theme_box() |> 
  padding(j = 1, i = ~ !is.na(group), padding.left = 15, part = 'body') |> 
  bg(i = ~ is.na(group), bg = 'grey80') |> 
  italic(i = ~ is.na(group), italic = TRUE) |> 
  width(width = 0.95) |> 
  width(j=1, width = 1.5) |> 
  align(align = 'center', part = 'all') |> 
  align(j = 1, align = 'left', part = 'all') |> 
  fontsize(size = 12, part = 'all') |> 
  font(fontname = 'Times New Roman', part = 'all')

tbl_object


```

\newpage
__Figure 1__: (A) Cumulative incidence of all-cause mortality by treatment group. (B) Time-dependent effect of randomization to intensive treatment for all-cause mortality.

```{r}

blank_plot <- ggplot(data.frame()) + aes() + theme_void()

legend <- get_legend(
  fig$inc_acm[[1]]$plot + 
    theme(legend.position = c(.55, .2),
          legend.direction = 'horizontal')
)

plot_grid(
  # row 1 (legend)
  legend, 
  blank_plot,
  # row 2 (figures)
  fig$inc_acm[[1]]$plot + theme(legend.position = ''), 
  fig$eff_acm[[1]],
  # row 3 (table)
  fig$inc_acm[[1]]$table, 
  blank_plot,
  ncol = 2,
  align = 'v',
  axis = 'lr',
  rel_heights = c(1,10,2),
  labels = c("","","A","B","",""),
  label_x = 0.1,
  label_y = 1.05
)

```

\newpage
__Figure 2__: (A) Cumulative incidence of cardiovascular and non-cardiovascular mortality by treatment group. (B) Time-dependent effect of randomization to intensive treatment for cardiovascular mortality.

```{r}

plot_grid(
  # row 1 (legend)
  legend, 
  blank_plot,
  # row 2 (figures)
  fig$inc_cvd[[1]] + theme(legend.position = ''), 
  fig$eff_cvd[[1]],
  ncol = 2,
  align = 'v',
  axis = 'lr',
  rel_heights = c(1,10,2),
  labels = c("","","A","B","",""),
  label_x = 0.1,
  label_y = 1.05
)

```

\newpage
__Figure 3__: Mean systolic blood pressure over time by treatment group. Shaded areas indicate a 95% confidence interval for the mean.

```{r}

knitr::include_graphics(
  path = 'Z:/bjaeger/sprint-mortality-ndi/fig/SPRINT_EHR_SBP_LongTerm_Comparison_122721.png', 
  dpi = 600
)

```


\newpage
__Figure 4__: All-cause mortality hazard ratio for participants randomized to intensive versus standard treatment.

```{r}

long_viz_mort

```

\newpage
__Figure 5__: Cardiovascular mortality hazard ratio for participants randomized to intensive versus standard treatment.

```{r}

long_viz_cvd

```




# SUPPLEMENT

To be decided.

```{r}
block_section(
  prop_section(
    page_size = page_size(orient = "landscape"),
    page_margins = page_mar(bottom = 1/8, top = 1/8, 
                            right = 1/4, left = 1/4),
    type = "continuous"
  )
)
```


# REFERENCES
